const CONST_CSV = '''
,反黑箱服貿協議・守護民主日與夜,,,"g0v.today 每 3 分鐘更新",,,
http://newday.tw/intro/,讓晨曦照亮民主,,守護民主手環:important,,,,
http://ecfa.speaking.tw/,服貿跑馬燈,"{""expand"":false} ",,"更新前請 *務必* 先刷新整頁試算表再改，感謝！",,,
" http://fact.g0v.tw/tisa.html",服貿跑馬燈-時間軸,,,,,,
" http://ecfa.speaking.tw/imho.php","服貿東西軍 ",,,,,,
" https://sites.google.com/site/twdstreet/",公民審服貿,,街頭民主審議:info,"影音更新時請記得 *保留前方空白* 和 /embed/ 格式, 把 youtube watch?v=XXXXXX 的 XXXXX 放到 /embed/ 後即可。ustream 也是使用 /embed/ (按「Share/共用」可取得 embed code) — 然後更新 D 欄的「時間」和 F 欄的「更新人」。感謝!",,,
http://123.g0v.today/,三動作護台灣,,致電立委:important,,,,
http://nonuke.today/,停建核四、遍地烽火全記錄,"{""target"":""_blank""}",新分頁:,,,,
http://hackfoldr.org/resistancelive/,香港7.1遊行暨後續活動現場直播,"{""target"":""_blank""}",新分頁:,,,,
http://hackfoldr.org/Kaohsiung-explode-20140801,高雄8.1氣爆救災資訊,"{""target"":""_blank""}",新分頁:important,,,,
http://i.imgur.com/PNyJAIq.png?3,LiveTW即時獲取直播頻道App,"{""expand"":true}",,,,,
" https://chrome.google.com/webstore/detail/livetw/fhcffinobmpdchcoapdeoinhdmlihiok",Chrome：,"{""target"":""_blank""}",新分頁:issue,,,,
" https://play.google.com/store/apps/details?id=com.g0v.live",Android：,"{""target"":""_blank""}",新分頁:issue,,,,
" http://inlivetw.github.io/chrome/",Web：,,新版:important,,,,
,政府各部會直播,"{""expand"": false}",,,,,
" http://www.ustream.tv/embed/18469624",7.11二次自經區深度溝通會前會,,,,,,
" http://www.ustream.tv/embed/18322764","行政院 經貿國是會議-戲智科技1",,,,,,
" http://www.ustream.tv/embed/18316356","行政院 經貿國是會議-戲智科技2",,,,,,
" https://livehouse.in/channel/NectwChannel-M","行政院 經貿國是會議-愛卡拉(iKala)1",,,,,,
" https://livehouse.in/channel/NectwChannel-S","行政院 經貿國是會議-愛卡拉(iKala)2",,,,,,
" https://livehouse.in/channel/yda","教育部 青年發展署",,,,,,
" http://www.appledaily.com.tw/livechannel/subject/37","蘋果LIVE 二次自經區溝通會",,,,,,
" http://www.appledaily.com.tw/livechannel/nationalmeeting01",蘋果LIVE經貿國是會議1,,,,,,
" http://www.appledaily.com.tw/livechannel/nationalmeeting02",蘋果LIVE經貿國是會議2,,,,,,
" https://www.youtube.com/channel/UC_7MwKr2JOoFH_xOF_R961A","行政院 國發會 二次自經區溝通會 Youtube過往直播","{""target"":""_blank""}",,,,,
" https://www.youtube.com/channel/UCqxZB7eJ34jf0rZUS_1LUAg","行政院 國發會 國是會議直播小組 Youtube過往直播","{""target"":""_blank""}",,,,,
" https://www.youtube.com/channel/UCfgXJRfOL1vek3YFw2QmJ5A","行政院 國發會 國是會議直播小組２ Youtube過往直播","{""target"":""_blank""}",,,,,
" https://www.youtube.com/channel/UCL39yxKnDTvz97uvs4hiYRQ/feed","行政院 金管會 Youtube過往直播","{""target"":""_blank""}",,,,,
,9/12立法院事件,"{""expand"":false}",,,,,
" http://lci.ly.gov.tw/",議事宣公報管理系統,,,,,,
" http://www.ly.gov.tw/01_lyinfo/0109_meeting/meetingList.action","立法院 會議預報",,,,,,
" http://www.cwb.gov.tw/V7/forecast/town368/towns/6300500.htm?layer=0&type=Weather&time=3Hr",立法院(中正區)天氣預報,,,,,,
" http://musou.tw/schedules","沃草國會無雙 賽事預報","{""target"":""_blank""}",,,,,
" http://musou.tw/live_streams/119",9/12沃草|國會無雙,"{""target"":""_blank""}",,,,,
" http://www.appledaily.com.tw/livechannel/subject/17",蘋果立法院議會LIVE,,,,,,
" http://www.ustream.tv/embed/17012502","沃草國會無雙 第一競技場",,,,,,
" http://www.ustream.tv/embed/17401996","沃草國會無雙 第二競技場",,,,,,
" http://www.ustream.tv/embed/17989031","沃草國會無雙 第三競技場",,,,,,
" http://www.ustream.tv/embed/17823792","民報直播 立法院OnLine",,,,,,
" https://livehouse.in/channel/watchout",【沃草直播室】,,,,,,
,"影音直播 (黑畫面請按F5)","{""expand"": true}",,,,,
" https://adblockplus.org/zh_TW/chrome",Chrome擋廣告外掛,"{""target"":""_blank""}",,,,,
" https://www.google.com/calendar/embed?src=ptt.publicissue%40gmail.com&src=ptt.publicissue2%40gmail.com&src=ptt.publicissue3%40gmail.com&src=ptt.publicissue4%40gmail.com&src=ptt.publicissue5%40gmail.com&src=ptt.publicissue6%40gmail.com&src=ptt.publicissue7%40gmail.com&mode=week&title=鄉民曆-所有事件",鄉民曆-所有事件,,,,,,
" http://www.ustream.tv/embed/17513092",拖鞋直播-1,,,,,,
" https://www.youtube.com/watch?v=bpKd1buf48U","Patch to GOV 當網民滲透國是、開放政策溝通 自經區溝通會及經貿國是會議小腸花",,,,,,
" http://www.ustream.tv/embed/18477607",張慶恩的台獨國際新聞,,,,,,
" http://www.ustream.tv/embed/18692687","山崎 公民記者",,,,,,
" http://www.ustream.tv/embed/18246634","欣欣 公民記者",,,,,,
" http://www.ustream.tv/embed/17969826","飛魚台 南部實況",,,,,,
" http://www.ustream.tv/embed/18245525","髒髒 公民記者",,,,,,
" http://www.ustream.tv/embed/18418362",北加州台灣青年民主電台(北加青年台),,,,,,
" http://www.ustream.tv/embed/17696763",桃園縣議會,,,,,,
" https://livehouse.in/channel/KPtaipei","8/18冰桶大挑戰 為漸凍人募款 柯文哲",,,,,,
" http://www.ustream.tv/embed/3526833",公視新聞網,,,"8pm 有話好說(星期一至三)、NGO觀點(星期四)、南部開講(星期五)、唱四方(星期六) 、部落大小聲(星期日) + 10pm 我們的島(星期一)、獨立特派員(星期三)",,,
" http://www.ustream.tv/embed/18698986",citizen393,,,,,,
" http://www.ustream.tv/embed/17733674","jackywolf 公民記者",,,,,,
" http://www.ustream.tv/embed/18030256","阿凱 公民覺醒紀錄",,,,,,
" https://www.youtube.com/watch?v=vWhcmzt5ORA",8/17【與台獨面對面】宜蘭巡迴演講,,,,,,
" http://www.ustream.tv/embed/17992061","Masaru 南部實況",,,,,,
" http://www.ustream.tv/embed/18231291","日升連線 公民記者",,,,,,
" http://www.ustream.tv/embed/17948037","豪豬 公民記者",,,,,,
" http://www.ustream.tv/embed/18103859",文森直播,,,,,,
" http://www.ustream.tv/embed/17157275","PENNYKEN 公民記者",,,,,,
" http://www.ustream.tv/embed/17929143","小六 公民記者",,,,,,
" http://www.ustream.tv/embed/18571065",社運紀實小組直播網,,,,,,
" http://www.ustream.tv/embed/18385635",阿弘直播台,,,,,,
" http://www.ustream.tv/embed/14787921",公民之聲,,,,,,
" http://www.ustream.tv/embed/17843610",電池線上,,,,,,
" http://www.ustream.tv/embed/18412678","麵包 公民記者",,,,,,
" http://www.ustream.tv/embed/17562385","麵線 公民記者",,,,,,
" http://www.ustream.tv/embed/18200914",直樹Live頻道,,,,,,
" http://www.ustream.tv/embed/18659589","台灣和平中立化 研討會",,,,,,
" http://www.ustream.tv/embed/18380808","小鳥台 公民記者",,,,,,
" http://www.ustream.tv/embed/7468658",文源LIVE秀,,,,,,
" http://www.ustream.tv/embed/17863662","點點 公民記者",,,,,,
" http://www.ustream.tv/embed/17897006",野自Live,,,,,,
" http://www.ustream.tv/embed/18296345",用人權改變你的生活──身心障礙者的自我倡議讀書會,,,,,,
" http://www.ustream.tv/embed/6065521",PTTradio,,,,,,
" http://www.ustream.tv/embed/18597273",踐踏民主面對審判暴力首謀江宜樺下台,,,,,,
" http://www.ustream.tv/embed/17941896",yokulive公民記者,,,,,,
" http://www.ustream.tv/embed/6203014","frangi33 公民記者",,,,,,
" http://www.ustream.tv/embed/18127743","Daniel Chen公民記者",,,,,,
" http://www.ustream.tv/embed/17755037","帽客 公民記者",,,,,,
" https://livehouse.in/channel/watchout",【沃草直播室】,,,,,,
" https://livehouse.in/channel/watchout2",【沃草直播室2】,,,,,,
" http://www.ustream.tv/embed/17894339","阿法 公民記者",,,,,,
" http://www.ustream.tv/embed/18506067","Mayaman 社運紀實",,,,,,
" http://www.ustream.tv/embed/18530557",鄉民email,,,,,,
" http://www.ustream.tv/embed/18109047","新竹蕾拉 公民記者",,,,,,
" http://www.ustream.tv/embed/17551115","蜂潮 再起",,,,,,
" http://www.ustream.tv/embed/18401148",梁文韜,,,,,,
" http://www.ustream.tv/embed/18062563",基進側翼,,,,,,
" http://www.ustream.tv/embed/18511952",哲學非星期五＠台中,,,,,,
" http://www.ustream.tv/embed/17811041",Sean-公民記者,,,,,,
" http://www.ustream.tv/embed/18308641",Citizentw,,,,,,
" http://www.ustream.tv/embed/17858274",台南民主店頭,,,,,,
" http://www.ustream.tv/embed/18482988",wwe_dx_jad,,,,,,
" http://www.ustream.tv/embed/18511678","阿至 公民記者",,,,,,
" http://www.ustream.tv/embed/18476332","公民線上 Citizen Live",,,,,,
" http://www.ustream.tv/embed/18407461","Eason小胖 公民記者",,,,,,
" http://www.ustream.tv/embed/18390482","米飛  公民記者",,,,,,
" http://www.ustream.tv/embed/17866960",小駿線上,,,,,,
" http://www.ustream.tv/embed/17916604",阿賢文旦直播台,,,,,,
" http://www.ustream.tv/embed/18379958","皮皮 公民記者",,,,,,
" http://www.ustream.tv/embed/18174265","小光 公民記者",,,,,,
" http://www.ustream.tv/embed/17996833","雪倫 公民記者",,,,,,
" http://www.ustream.tv/embed/17622630","banana 公民記者",,,,,,
" http://www.ustream.tv/embed/17958896",拖鞋直播-2,,,,,,
" http://www.ustream.tv/embed/17587751",拖鞋直播-3,,,,,,
" http://www.ustream.tv/embed/17894854",拖鞋直播-日本語,,,,,,
" http://www.ustream.tv/embed/17857738",公投盟直播,,,,,,
" http://www.ustream.tv/embed/17568654",南民思潮,,,,,,
" http://www.ustream.tv/embed/17923438",公民Live直播,,,,,,
" http://www.ustream.tv/embed/17878254","Jivedbyvoice 公民記者",,,,,,
" http://www.ustream.tv/embed/17890296","雨停 公民記者","{""bar"": ""http://g0v.github.io/live/status_bar.html?{url}"", ""enable_bar"": {""video"":true}}",,,,,
" http://www.ustream.tv/embed/17988421","Hulk_Che 公民記者",,,,,,
" http://www.ustream.tv/embed/18223731",台灣民政府1,,,,,,
" http://www.ustream.tv/embed/14603849",台灣民政府2,,,,,,
" http://www.ustream.tv/embed/18445690",penghuyouth,,,,,,
" http://www.ustream.tv/embed/16630308","Indie Love",,,,,,
" http://www.ustream.tv/embed/13620594",五六運動、公民論壇,,"週五1800~2100:,中正紀念堂:,自由廣場前:",,,,
" http://www.ustream.tv/embed/17989057",哲學星期五＠台中,,,,,,
" http://www.ustream.tv/embed/18608702",哲學星期五＠台北,,,,,,
" http://www.ustream.tv/embed/18654171",蠻野講堂,,,,,,
" http://www.ustream.tv/embed/18123294","週五 太陽花講習會",,"活動暫停:,週五1900~2100:,中正紀念堂:,國家劇院前:",,,,
" http://www.ustream.tv/embed/17640717","人民民主陣線 人民議會",,,,,,
" http://www.ustream.tv/embed/17569549","g0v 1號機",,,,,,
" http://www.ustream.tv/embed/17557850","g0v 2號機",,,,,,
" http://www.ustream.tv/embed/17680676","g0v 3號機",,,,,,
" http://www.ustream.tv/embed/17592160","g0v 4號機",,,,,,
" http://www.ustream.tv/recorded/45245933",行政院機動組2,,,,,,
" http://www.ustream.tv/embed/17537793","濟南路 南側 ",,,,,,
" http://www.ustream.tv/embed/17576277",清大野台講堂,,,,,,
" http://www.ustream.tv/embed/12933307",公投盟直播機,,,,,,
" http://www.ustream.tv/embed/17859517",南方公民網,,,,,,
,過往直播,"{""expand"":false} ",,,,,
" https://www.youtube.com/channel/UCTRscVMDqFN5bU1mAZw1QSg/videos","Dai Wan Lang Youtube過往直播","{""target"":""_blank""}",新分頁:issue,,,,
" https://www.youtube.com/user/ShotForDemocracy/videos","公民攝影守護民主陣線 Youtube過往直播","{""target"":""_blank""}",新分頁:issue,,,,
" https://www.youtube.com/watch?v=PsMXyy2yneQ","天光-太陽花學運攝影集 發表會現場直播",,,,,,
" http://www.appledaily.com.tw/livechannel/archive/43/275/1",7/30雞排妹VS楊伊湄重播,,,,,,
" https://www.youtube.com/watch?v=4q0gMWcl9JU#t=2825","7/27IDEAS Tech Hackathon 成果展示現場直播",,,,,,
" https://www.youtube.com/watch?v=jhBebtXaIC8"," 蘋果LIVE[直擊現場]香港七一遊行",,,,,,
" http://www.ustream.tv/recorded/45245933",行政院機動組2,,,,,,
" https://www.youtube.com/watch?v=HwhE9nKcWdQ",壹電視,,,,,,
" http://www.youtube.com/embed/mXp2iD8QxvE","濟南路 (g0v)",,,,BITCHDOG,lee,
" http://www.youtube.com/embed/sHKXPgq19xg","議場內 1F (音地) ",,,,indietaiwan,,
" http://www.youtube.com/embed/kfLE82spRME",青島東立院廣場,,,,,oJelly,
" http://www.youtube.com/embed/olBRbBz-q_g","議場內 2F (蘋報) ",,,,appledaily,au,
" http://www.youtube.com/embed/fIpmkvtvtaQ","青島東 (g0v)",,,1915pm,"bert Wang","bert Wang",
" http://www.youtube.com/embed/-cWb3SnnyfM","青島東 (蘋報) ",,,,appledaily,au,
" http://www.youtube.com/embed/pxv-thjDpfU","進場過程 3/18 ",,,,,,
" http://www.youtube.com/embed/rm5kI7X6sJ0","場外 3/18 ",,,,,,
" http://www.youtube.com/embed/yj9Dy0IMmi0","場外 3/19 上午 ",,,,,,
" http://www.youtube.com/embed/bgHcFFWnXkM","場外 3/19 下午 ",,,,,,
" http://www.youtube.com/embed/pptmdPk-0DQ","北側 3/19 晚間 ",,,,,,
" http://www.youtube.com/embed/mpqkvYTM30g","北側 3/19 傍晚 ",,,,,,
" http://www.youtube.com/embed/dDimp7TDhJw","北側 3/19 下午 ",,,,,,
" http://www.youtube.com/embed/wKuWnBSXF3s","3/19 警方凌晨 3 點第一波攻堅 ",,,,,,
" http://www.youtube.com/embed/_rwNDRKG-uI","議場內（蘋報 319） ","  ",,"  ",,,
" http://www.youtube.com/embed/0J4mZlkFmRs","議場內（蘋報 320） ",,,"hychen ",,,
" http://www.youtube.com/embed/odUyLRc3P0M","台中 ",,,,,,
" http://www.youtube.com/embed/uTxGjgRu3Xs",行政院機動組1,,,,,,
" http://www.youtube.com/embed/WjB7waqvNQk","北側 3/24",,,,,,
" http://www.youtube.com/embed/gq4T8UPSpJk","濟南路 舞台 (音地) ",,,,,,
" http://www.youtube.com/embed/FvbvAH5_0oI","議場內（蘋報 323） ",,,,,,
" http://www.youtube.com/embed/m-Vo5DjxNlo","議場內（蘋報 326） ",,,,,,
" http://www.youtube.com/embed/Rafu80fdAK0","凱道主講台 (音地 330)",,,,,,
" https://www.google.com/calendar/embed?src=ptt.publicissue%40gmail.com&src=ptt.publicissue2%40gmail.com&src=ptt.publicissue3%40gmail.com&src=ptt.publicissue4%40gmail.com&src=ptt.publicissue5%40gmail.com&src=ptt.publicissue6%40gmail.com&src=ptt.publicissue7%40gmail.com&mode=week&title=鄉民曆-所有事件",鄉民曆-所有事件,,,,,,
,持續關注&即將發生事件,"{""expand"": false}",,,,,
" https://www.facebook.com/aorft/posts/777770432268209","控訴國家暴力自訴案件 3/23~24尋找證人",,有些帳現在不算，以後就沒機會了！:important,,,,
" http://www.appledaily.com.tw/realtimenews/article/recommend/20140731/443177/","323政院驅離 江:我在睡覺",,,,,,
" https://www.ptt.cc/bbs/PublicIssue/M.1404310911.A.D60.html","後灣開發案 不要再被財團騙了",,"線上連署:important,結束時間未定:info",,,,
" https://www.facebook.com/yilanforyilaneses",[宜蘭]「反對北宜直鐵」,,,,,,
" https://www.ptt.cc/bbs/PublicIssue/M.1406317312.A.B11.html","市政府前香山R1道路記者會 徵收七連",,,,,,
" http://blog.yam.com/munch/article/74663358",徵收七連莊—陳文賢家族的百年悲傷,"{""target"":""_blank""}",,,,,
" https://www.facebook.com/vivian.chang.18041/posts/10152368592518022","桃園 五千坪客家老宅即將變廢墟",,,,,,
" http://news.ltn.com.tw/news/politics/breakingnews/1065208","桃園道東堂有救？ 文化局7/29會勘",,,,,,
" http://news.ltn.com.tw/news/life/breakingnews/1055057","北纜案 北市府將再上訴",,7月底最後上訴期限:important,,,,
" http://www.appledaily.com.tw/realtimenews/article/new/20140730/443067/","7/30郭冠英糾正案 省府今決議「依法任用」",,,,,,
" http://www.stormmediagroup.com/opencms/news/detail/83f5c8b0-08f5-11e4-8645-ef2804cba5a1/?uuid=83f5c8b0-08f5-11e4-8645-ef2804cba5a1",九月海協會長陳德銘訪台,,,,,,
" https://www.facebook.com/photo.php?fbid=826029420740740&set=a.126145224062500.21698.100000010685369&type=1&permPage=1","7/24~8/2[台中活動]搶救神岡浮圳 10日大作戰",,,,,,
" http://campaign.tw-npo.org/sign.php?id=20140322102327",反對神岡移水圳砍老樹-浮圳拓路一案,," 網路連署:info",,,,
" https://www.facebook.com/LoveShengang/photos/a.238796589659260.1073741837.233374530201466/277504339121818/?type=1","大家來找碴之 神岡浮圳 細部設計圖",,,,,,
" https://www.facebook.com/Save110YearsTaipeiPrison/photos/a.248468998684401.1073741831.247895508741750/268016093396358/?type=1",[全國活動]搶救台北刑務所北官舍與台灣第一菊元百貨,,,,,,
" https://www.facebook.com/Save110YearsTaipeiPrison/posts/272260729638561",致電守護瀕危的百年台北刑務所,,打電話給立委們:info,,,,
" http://www.van698.com/thread-157668-1-1.html",鼓勵檢舉賄選要點,,,,,,
,全台活動,"{""expand"":false}",,,,,
" https://www.facebook.com/events/634254783357130",8/11~8/29[活動]裝一片機車台獨擋泥板來練勇氣,,"後門咖啡:,台北市大安區復興南路2段332號:,B back咖啡:,台中市西屯區逢甲路225巷16號1樓:,林明正市議員競選總部:,台中市大里區中興路一段300號:,基進側翼總部:,高雄市前金區中正四路235號12F-1:,公投盟建國基地:,台北市濟南路:",,,,
" https://www.facebook.com/chiyen.ca/posts/4521981704084",8/20[台北市會議]全市性保護區處理原則專案小組會議,,"0930~1130,市政大樓:,信義區市府路一號:,八樓西南區:",,,,
" https://www.facebook.com/twedumove/posts/523774274389642",8/20[監察院]國教盟赴監察院陳情十二年國教違法,,"1000~1200,監察院:",,,,
" http://www.coolloud.org.tw/node/79769",8/20[立院記者會]公審會不要淪為民主殺手,,"1000~1200,立法院中興大樓103室:",,,,
" http://www.coolloud.org.tw/node/79768","8/20[司法院記者會]人民民主陣線 鏟土豪行動",,"1030~1230,司法院大門口:,中正區重慶南路一段124號:",,,,
" http://www.coolloud.org.tw/node/79765",8/20[台北記者會]「技職再造」還是「技職再見」？,,"1000~1200,忠孝東路一段138號11樓:,台灣高等教育產業工會會議室:",,,,
" https://www.facebook.com/events/733124453391313","8/20[教育部]拒絕國教公聽會取暖 爭取學生聲音進入諮詢會",,"1300~1500,教育部中山南路大門口:",,,,
,"公投法 割闌尾 小蜜蜂 參政","{""expand"": false}",,,,,
" http://taiwanmarch.tw/signedonline.html","公投修法 連署書",,線上填寫:info,,,,
" https://www.facebook.com/Appendectomy/photos/a.249135138604869.1073741828.248848828633500/280790655439317/?type=1&theater",割闌尾連署書回郵正式上線,,免貼郵票:info,,,,
" https://www.facebook.com/events/752091854832665/","8/20~8/22[[台中活動]全面罷免 今天 你舉了沒？",,"0730~0830,1730~1830,中港路vs文心路路口:",,,,
" https://www.ptt.cc/bbs/PublicIssue/M.1408451357.A.83B.html",8/20[桃園小蜜蜂]內壢家樂福,,"1830~2030,內壢家樂福:,中壢市中華路一段450號:",,,,
" https://www.facebook.com/permalink.php?story_fbid=343015512528015&id=320272928135607","8/20[台北割闌尾]內湖 蔡正元",,"1800~2030,內湖737巷(一流眼鏡行):8/20",,,,
,,,"1830~2000,葫洲捷運站:8/21",,,,
,,,"1630~2000:,東湖哈拉中信:,1900~2100:,大湖公園銅像前公民論壇(重點場):8/23",,,,
,,,"0900~1200,西湖市場:,1630~2000,東湖哈拉中信:,1630~2000,全聯康樂店(近東湖國中):,1700~1930,碧湖公園:8/24",,,,
" https://www.facebook.com/apkh.tw/posts/358284264323600",8/20[高雄割闌尾]黃昭順,,"0700~0930,楠梓7-11德祥門市:,德賢路246號:8/20",,,,
,,,"週一1930~2130,雙十人行廣場:,捷運江子翠站三號出口:,沿雙十路走:,屈臣氏和Starbucks之間:",,,,
" https://www.facebook.com/AppendectomyDeWhip/posts/610964449011595",8/21[板橋割闌尾]林鴻池(固定擺攤),,"週四1900~2100:,新埔郵局:,捷運新埔站旁，近一號出口:,新北市板橋區文化路1段395號:",,,,
,,,"週六1730~1930:,板橋車站的站前廣場:,板橋萬坪都會公園:,靠近""文化路一段""那一側:,捷運板橋站三號出口:,出來後向文化路一段方向走:",,,,
" http://www.totalrecall.tw/events.html",[台中割闌尾]蔡錦隆,,,,,,
,全台講座,"{""expand"": false}",,,,,
" https://www.facebook.com/events/1448906642042211",8/20[台北座談]勞基法30年的變革與挑戰,,"0900~1700,台大校友會館3A會議室:,台北市濟南路一段2-1號:",,,,
" https://www.facebook.com/events/1467926683462077/",8/20[台北講座]知識++講堂第二彈：憲法、權力與權利,,"1900~2100,財團法人超越文創教育基金會:,台灣台北市南京東路二段160號:",,,,
" https://www.facebook.com/events/629934033770473/",8/20[台北講座]看日本集體自衛權解禁對台灣戰略環境的影響,,"1930~2130,慕哲咖啡:,台灣紹興北街3號:",,,,
" http://tsguide1.blogspot.tw/2014/08/blog-post_14.html","8/20[台北活動]淡水 街頭讀書會",,"1930~2130,淡水區三民街11-2號3樓:",,,,
" http://gr33n.kktix.cc/events/hacknight-5","8/20[台北活動]第伍次綠客松 x 動民主：open hack night","{""target"":""_blank""}","1930~2130,台北市德惠街23號B1:",,,,
,次日活動,"{""expand"": false}",,,,,
" https://www.facebook.com/pttcitizen1985/photos/a.307121876091884.1073741829.306729736131098/488475721289831/?type=1&relevant_count=1","(活動延期)[立法院旁濟南路]「去年覺醒 今年行動」晚會",," 時間未定",,,,
" http://www.tahr.org.tw/node/1455",8/21[高雄講座]社運與鄉民之間,,"1900~2100,高雄市左營區博愛二路198號9樓之一:,台灣人權促進會南部辦公室:,蔡中岳:important,地球公民基金會北部辦公室主任:important,林樂昕 小八:important",,,,
" https://www.facebook.com/wildatheart.org/photos/a.10150270921515580.487714.456802825579/10154405482065580","8/22[台北講座]蠻野講堂#3 扭轉的力量 一段被老樹啟發的社會運動",,"1900~2100,呷米共食廚房3樓:,台北市中正區衡陽路9號:,申惠濟:important, 禾勤景觀工程 負責人:important,搶救老樹的景觀設計師:important",,,,
" http://www.beclass.com/rid=173525253ac341855daf",8/22[台南演講]WuTalk--作伙講台語，本土語言的世代傳承,,"1900~2100,台南市南門路21號:,潘靜竹:important,府城舊冊店執行長:important,台灣教師聯盟秘書:important",,,,
" https://docs.google.com/forms/d/1MLxWcWGETeMbkhH57pPpmCoGecqp8CwVDCyWNf_lVqY/viewform?fbzx=7578344857076229268",8/23[台北講座]一場華麗的革命：我們需要什麼樣的新聞,,"1000~1200,文化大學大新館309教室:,台北市延平南路127號:,楊士範:important,關鍵評論網創辦人:important",,,,
" https://www.facebook.com/events/259445324255309",8/23[台北工作坊]《告白三一八》：運動經驗工作坊#3,,"1400~1700,關渡美術館:,台灣台北市北投學園路1號:",,,,
" http://homelessoftaiwan.pixnet.net/blog/post/58100049","8/23[台北講座]反迫遷連線 居住權戰鬥教室 首爾都市治理經驗分享",,"0910~1000,政大公企中心:,彭龍三:important,台灣都市更新受害者聯盟理事長:important,陳虹穎:important,台灣都市更新受害者聯盟研究員:important",,,,
" https://www.facebook.com/369779613823/photos/a.10150444890403824.422908.369779613823/10152677531508824","8/23[臺北座談]麗君追思系列活動#2 妓運先鋒，守護文萌樓",,"1830~2130,台北市大同區歸綏街139號:",,,,
" https://www.facebook.com/pages/%E6%88%91%E6%98%AF%E4%BA%BA%E6%88%91%E5%8F%8D%E6%A0%B8/307969115955037",五六運動、公民論壇,,"每週五,1800~2100,中正紀年堂 自由廣場:",,,,
" https://www.facebook.com/events/735071376532010/?ref=3&ref_newsfeed_story_type=regular","8/23~8/25[美國華盛頓]2014 FAPA YPG National Advocacy Conference",,,,,,
" https://zh-tw.facebook.com/TIRAFANS/posts/1455096488079557","8/23[臺北大旗]101臺獨舉大旗 公民自決 悍衛民主",,"1600~1830,台北101捷運4號出口:",,,,
" http://www.happyradio.com.tw/stream/stream_taipei.php","週一 黑鬥不服從",,"1700~1800,廣播[快樂連播網]:info",,,,
" https://www.facebook.com/red99hu/posts/1540102946217924",8/26[台中演講]台灣國會透明化促進協會成立,,"1900~2130,台東縣政府文化處演講廳:",,,,
" http://www.accupass.com/event/register/443138588427426","8/28[台北演講]博雅青年講堂 從媒體到公民記者",,"1800~2100,客家文化會館:,大安區信義路三段157巷11號4F:",,,,
" http://www.cet-taiwan.org/node/1995",8/29[高雄講座]德國農村的氣候變遷調適和發展,,"1900~2100,地球公民基金會高雄總部:,左營區博愛二路198號9F-2:",,,,
" https://www.facebook.com/events/791984067512536#_=_","8/30[台北活動]破窗而入 抗爭演習工作坊",,"1400~1700,關渡美術館:",,,,
" https://www.facebook.com/tainmugreenstone/posts/173364406167628",8/31[台北導覽]天母文化歷史生態導覽,,"0900~1000,台北市中山北路七段81巷45號:",,,,
" http://www.accupass.com/go/0818windpower",9/11[台北講座]「自願性綠色電價」有何問題,,"1900~2130,中正區羅斯福路二段9號10樓-2:,近捷運古亭站6號出口:,徐光蓉:important,台灣大學大氣科學系教授:important",,,,
" http://www.beclass.com/rid=173525253ac341855daf","9/19[台南演講]WuTalk 在開發中黯淡的百年華光：台灣對中國的經濟依賴與「自由」貿易",,"1900~2100,台南市南門路21號:,臺南數位文創園區-胖地:,許忠信:important,成大法律系教授:important",,,,
,文字轉播專區,"{""expand"":false} ",,,,,
" http://ncc.nctu.pro/","服貿討論 (交大)",,,,,,
" https://ethercalc.org/static/proxy/hackpad/","文字轉播 (主要) ",,,,,,
" http://congress-text-live.herokuapp.com/","文字轉播 (同上)",,,,,,
" https://ethercalc.org/static/proxy/live.txt","文字轉播 (內場)",,,,,,
" https://ethercalc.org/static/proxy/english/","English Transcript",,,,,,
" https://docs.google.com/document/d/1Esi-GjLXFwF0CDsykyddGaWBTnM22zeVY4ciZ0gyf9M/pub","320 街頭民主教室逐字稿紀錄",,,,,,
" https://ethercalc.org/static/proxy/hackpad/3-24.html","3-24 中午備份",,,,,,
" https://ethercalc.org/static/proxy/english/3-24.html","3-24 Noon Archive",,,,,,
" https://docs.google.com/document/d/1uTmn5-nUKW-MEpR5ygBfG10HEJ-Zul4TrtntKAOPxbQ/edit?disco=AAAAAH_Tjng ","文字轉播 GoogleDoc",,,,,,
" https://ethercalc.org/static/proxy/hackpad/8a13Bv9DNla","4-22 零時文播",,,,,au,
,"人力物資需求 ","{""expand"":false} ",,,,,
" https://g0v.hackpad.com/-Live--HpwTUS2OShF ","遠端文字轉播排班表 ",,停止:,,,,
" https://docs.google.com/spreadsheets/d/1zxF2MhhCedsKE23lW4sDHb7Uo2HrkEp3VusdWQruRzQ/pubhtml","守護民主之夜 現場需求",,停止:,,,,
" https://docs.google.com/spreadsheet/ccc?key=0AkNsS2a-Qx8ZdGpmekpMQjJBNWZsbjh6cUxORVR4QUE&usp=sharing ","青島東路線路組物資需求 ",,停止:,,,,
,抗議行動相關資訊,"{""expand"":""false""} ",,,,,
" https://g0v.hackpad.com/2dCf0sLS70c",聯合指揮中心窗口,,,,,,
" https://docs.google.com/document/d/1t0Xxy3mI4Ct2QBp6kqoi1NDtgQVe1EMlBlFEu7e6qZQ/pub ","抗議者自保須知 ",,,,,,
" https://mapsengine.google.com/map/u/1/embed?mid=zlxW8eSZKLlk.k1Nzj2E6NfgY",周邊地圖,,,,,,
" https://docs.google.com/spreadsheet/ccc?key=0AjG4NH1Ti5o1dFZfdjd2alRLaW83WHpuX0JnUmJPZmc","台北以外活動 ",,,,,,
,"媒體區  - Media","{""expand"":false} ",,,,,
" https://g0v.hackpad.com/318--vCNzeS4wnbh","318 學運罷課聲明",,,,,,
" https://g0v.hackpad.com/ep/pad/static/HeVtO3WBpXk","English Communiqué",,,,,,
" https://docs.google.com/document/d/1oVxDBCcp4b-IJmIL4-duQo1Y4SBzAUBtwcrUfTdLj18/edit?usp=sharing ","各團體行動聲明 ",,,,,,
" https://g0v.hackpad.com/318--H6s4KlBRSC3","各團體行動聲明 (備份) ",,,,,,
" https://g0v.hackpad.com/-FAQ-gGlUisv5cMG","佔領立法院行動 FAQ ",,,,,,
" https://g0v.hackpad.com/A4-7E4ts6CMRsq","佔領立法院 A4 傳單 ",,,,,,
" https://g0v.hackpad.com/X0fp4Z6AhiL","街頭採訪要點 ",,,,,,
" https://docs.google.com/spreadsheet/ccc?key=0AjG4NH1Ti5o1dHhIeVdaTHNnMjhIT1VWRm5VSjNQd1E",外電消息整理,,,,,,
" https://docs.google.com/document/d/1NoiYQyZOhGcN2cRA9DRZ85_sFh7AUe-lpaxPmNcO1Ps/edit?usp=sharing ","照片來源 ",,,,,,
" https://g0v.hackpad.com/--PEn9NyJRh2X","創作收集 ",,,,,,
" http://occupation.today/","照片與訊息 Tumblr ",,,,,,
" http://review.fumao.today/",自己的服貿自己審,"{""target"": ""_blank""} ",新視窗:info,,,,
" https://www.facebook.com/NtuNewsEForum",台大新聞E論壇,"{""target"": ""_blank""} ",新視窗:info,,,,
,連結彙集平台,"{""expand"":false} ",,,,,
" http://time-fumao.rhcloud.com/",太陽花怪獸,,,,,,
" http://news.anon.tw",台灣大補帖＃fumao.tw,,,,,,
'''

angular.module 'app.controllers' <[ui.state ngCookies]>
.controller AppCtrl: <[$scope $window $state $rootScope $timeout]> ++ ($scope, $window, $state, $rootScope, $timeout) ->
  $scope.$watch '$state.current.name' ->
    $scope.irc-enabled = true if it is \irc

  # mobile
  window.addEventListener "load" ->
    <- $timeout _, 0
    window.scrollTo 0, 1

  <- $timeout _, 10s * 1000ms
  $rootScope.hideGithubRibbon = true

.controller HackFolderCtrl: <[$scope $sce $window $state $cookies HackFolder]> ++ ($scope, $sce, $window, $state, $cookies, HackFolder) ->
  $scope <<< do
    hasViewMode: -> it?match /g(doc|present|draw)/
    sortableOptions: do
      update: -> console?log \notyetupdated
    iframes: HackFolder.iframes
    docs: HackFolder.docs
    tree: HackFolder.tree
    godoc: (doc) ->
      if doc.opts?target == '_blank'
        window.open doc.url, doc.id
        return true
      else if doc.url.match /(https?:)?\/\/[^/]*(github|facebook)\.com/
        window.open doc.url, doc.id
        return true
      else
        $scope.go "/#{ $scope.hackId }/#{ decodeURIComponent doc.id }"
    open: (doc) ->
      window.open doc.url, doc.id
      return false
    activate: ->
      doc = HackFolder.activate it
      if doc?type is \hackfoldr
        console?log \folder!!
    saveBtn: void
    saveModalOpts: dialogFade: true
    saveModalOpen: false
    showSaveModal: (show,rm,e)->
      $scope.saveModalOpen = show
      if e => $scope.saveBtn = $ e.target
      if rm =>
        $cookies.savebtn = \consumed
        if $scope.saveBtn => $scope.saveBtn.fadeOut 1000
    showSaveBtn: ->
      $cookies.savebtn != \consumed
    HackFolder: HackFolder
    barframeSrc: (entry) ->
      src = entry.opts.bar.replace /\{(\w+)\}/g, -> entry[&1]
      $sce.trustAsResourceUrl src
    iframeCallback: (doc) -> (status) -> $scope.$apply ->
      console?log \iframecb status, doc
      $state.current.title = "#{doc.title} – g0v.today"
      if status is \fail
        doc.noiframe = true
      else
        doc.noiframe = false
      doc.iframeunsure = true if status is \unsure

    debug: -> console?log it, @
    reload: (hackId) -> HackFolder.getIndex hackId, true ->

  $scope.$watch 'hackId' (hackId) ->
    <- HackFolder.getIndex hackId, false
    $scope.$watch 'docId' (docId) ->
      doc = HackFolder.activate docId if docId
      if doc?type is \hackfoldr
        $scope.show-index = true
        folder-title, docs, tree <- HackFolder.load-remote-csv doc.id
        [entry] = [entry for entry in HackFolder.tree when entry.id is docId]
        entry.tagFilter = entry.tags?0?content
        unless entry.chidlren
          entry.children ?= tree?0.children
          HackFolder.docs.splice docs.length, 0, ...docs
        $scope.indexDocs = docs
        $scope.indexSearch = hackId.replace /^g0v-/,''
      else
        $scope.show-index = false
    $scope.show-index = $state.current.name is \hack.index
    return if $scope.show-index
    unless $scope.docId
      if HackFolder.docs.0?id
        $state.transitionTo 'hack.doc', { docId: that, hackId: $scope.hackId}

  $scope.collapsed = $cookies.collapsed ? $window.innerWidth < 768
  $scope.$watch 'collapsed' -> if it?
    $cookies.collapsed = it

  $scope.hackId = if $state.params.hackId => that else 'congressoccupied'
  $scope.$watch '$state.params.docId' (docId) ->
    $scope.docId = encodeURIComponent encodeURIComponent docId if docId
  $scope.sidebar = false
  $scope.toggleSidebar = ->
    $scope.collapsed = false
    $scope.sidebar = !$scope.sidebar

.directive 'resize' <[$window]> ++ ($window) ->
  (scope, element, attrs) ->
    refresh-size = ->
      scope.width = $window.innerWidth
      scope.height = $window.innerHeight
      scope.content-height = $window.innerHeight - $ element .offset!top

    angular.element $window .bind 'resize' ->
      scope.$apply refresh-size

    refresh-size!

.directive 'ngxIframe' <[$parse]> ++ ($parse) ->
  link: ($scope, element, attrs) ->
    cb = ($parse attrs.ngxIframe) $scope
    dispatch = (iframe, loading) ->
      ok = !try
        iframe.location ~= \about:blank
      # access denied, meaning the iframe is loaded. wait for .load to fire
      if loading and $.browser.mozilla
        # check if the failure is actually XFO denied. this doesn't work
        # req = $.ajax do
        #   type: \OPTION
        #   url: attrs.src
        #   success: ->
        #     console.log \done
        #     req.getAllResponseHeaders!
        #   error: (request, textStatus, errorThrown) ->
        #     console.log \err textStatus, request.getAllResponseHeaders!
        #     console.log request
        cb \unsure
      else
        cb if ok => \ok else \fail

    var fail
    $ element .load ->
      clearTimeout fail
      dispatch @contentWindow, true

    fail = setTimeout (->
      dispatch element[0].contentWindow
    ), 5000ms
.directive \ngxNoclick ->
  ($scope, element, attrs) ->
    $ element .click -> it.preventDefault!; false

.directive 'ngxClickMeta' <[$parse]> ++ ($parse) ->
  link: ($scope, element, attrs) ->
    cb = $parse attrs.ngxClickMeta

    is-meta = if navigator.appVersion.match /Win/
      -> it.ctrlKey
    else
      -> it.metaKey

    $ element .click (e) ->
      if is-meta e
        unless cb $scope
          e.preventDefault!
          return false
      return

.directive \ngxFinal ->
  ($scope, element, attrs) ->
    $ element .click -> it.stopPropagation();

.directive \scrollbar <[$window]> ++ ($window) ->
  (scope, element, attrs) ->
    has-scrollbar = ->
      $index = $('.index')
      scope.has-scrollbar = $index.get(0).scrollHeight > $window.innerHeight - $('.navbar').height()
    angular.element $window .bind \resize ->
      scope.$apply has-scrollbar
    scope.$watch 'docs' has-scrollbar
    has-scrollbar()

.factory HackFolder: <[$http $sce]> ++ ($http, $sce) ->
  iframes = {}
  docs = []
  tree = []
  var hackId
  self = do
    iframes: iframes
    docs: docs
    tree: tree
    activate: (id, edit=false) ->
      [doc] = [d for d in docs when d.id is id]
      type = doc?type
      for t in tree
        if t?children?map (.id)
          t.expand = true if id in that
      mode = if edit => \edit else \view
      src = match type
      | \gdoc =>
          "https://docs.google.com/document/d/#id/#mode?pli=1&overridemobile=true"
      | \gsheet =>
          "https://docs.google.com/spreadsheet/ccc?key=#id"
      | \gpresent =>
          "https://docs.google.com/presentation/d/#id/#mode"
      | \gdraw =>
          "https://docs.google.com/drawings/d/#id/#mode"
      | \gsheet =>
          "https://docs.google.com/spreadsheet/ccc?key=#id"
      | \hackpad =>
        "https://#{ doc.site ? '' }hackpad.com/#{id}"
      | \ethercalc =>
          "https://ethercalc.org/#id"
      | \video =>
          if doc.provider is \youtube
              "https://www.youtube.com/embed/#{id}"
          else if doc.provider is \ustream
              "http://www.ustream.tv/embed/#{id}?v=3"
      | \url => decodeURIComponent decodeURIComponent id
      | otherwise => ''

      src += doc?hashtag if doc?hashtag

      src = $sce.trustAsResourceUrl src if src
      return doc if doc?type is \hackfoldr
      if iframes[id]
          that <<< {src, mode}
      else
          iframes[id] = {src, doc, mode}
      return doc

    getIndex: (id, force, cb) ->
      return cb docs if hackId is id and !force
      retry = 0
      doit = ~>
        csv = CONST_CSV
        <~ setTimeout _, 1ms
        #csv <~ $http.get "https://www.ethercalc.org/_/#{id}/csv"
        #.error -> return if ++retry > 3; setTimeout doit, 1000ms
        #.success

        hackId := id
        docs.length = 0
        @process-csv csv, cb
      doit!


    process-csv: (csv, cb) ->
      folder-title, docs <- @load-csv csv, docs, tree
      self.folder-title = folder-title
      cb docs

    load-remote-csv: (id, cb) ->
      #csv <~ $http.get "https://www.ethercalc.org/_/#{id}/csv"
      #.success
      csv = CONST_CSV
      <~ setTimeout _, 1ms
      docs = []
      tree = []
      folder-title <~ @load-csv csv, docs, tree
      cb folder-title, docs, tree

    load-csv: (csv, docs, tree, cb) ->
      csv -= /^\"?#.*\n/gm
      var folder-title
      folder-opts = {}
      entries = for line in CSV.parse(csv)
        [url, title, opts, tags, summary, ...rest] = line
        continue unless title
        title -= /^"|"$/g
        opts -= /^"|"$/g if opts
        if opts
          opts = try JSON.parse opts.replace /""/g '"'
        opts ?= {}
        tags -= /^"|"$/g if tags
        [_, prefix, url, hashtag] = url.match /^"?(\s*)(\S+?)?(#\S+?)?\s*"?$/
        entry = { summary, hashtag, url, title, indent: prefix.length, opts: {} <<< folder-opts <<< opts } <<< match url
        | void
            unless folder-title
              if title
                folder-title = title
                title = null
              if opts
                folder-opts = opts
            title: title
            type: \dummy
            id: \dummy
        | // ^\/\/(.*?)(?:\#(.*))?$ //
            type: \hackfoldr
            id: that.1
            tag: that.2
        | // ^https?:\/\/www\.ethercalc\.(?:com|org)/(.*) //
            type: \ethercalc
            id: that.1
        | // https:\/\/docs\.google\.com/document/(?:d/)?([^/]+)/ //
            type: \gdoc
            id: that.1
        | // https:\/\/docs\.google\.com/spreadsheet/ccc\?key=([^/?&]+) //
            type: \gsheet
            id: that.1
        | // https:\/\/docs\.google\.com/drawings/(?:d/)?([^/]+)/ //
            type: \gdraw
            id: that.1
        | // https:\/\/docs\.google\.com/presentation/(?:d/)?([^/]+)/ //
            type: \gpresent
            id: that.1
        | // https?:\/\/(\w+\.)?hackpad\.com/(?:.*?-)?([\w]+)(\#.*)?$ //
            type: \hackpad
            site: that.1
            id: that.2
        | // https?:\/\/(?:youtu\.be/|(?:www\.)?youtube\.com/(?:embed/|watch\?v=))([-\w]+) //
            type: \video
            provider: \youtube
            id: that.1
            icon: "http://g.etfv.co/#{ url }"
        | // https?:\/\/(?:www\.)?ustream\.tv/(?:embed|channel)/([-\w]+) //
            type: \video
            provider: \ustream
            id: that.1
            icon: "http://g.etfv.co/#{ url }"
        | // ^(https?:\/\/[^/]+) //
            type: \url
            id: encodeURIComponent encodeURIComponent url
            icon: "http://g.etfv.co/#{ that.1 }"
        | otherwise => console?log \unrecognized url

        if entry.type is \dummy and !entry.title?length
          null
        else
          {icon: "/img/#{ entry.type }.png"} <<< entry <<< do
            tags: (entry.opts?tags ? []) ++ ((tags?split \,) ? [])
              .filter -> it.length
              .map (tag) ->
                [_, content, c, ...rest] = tag.match /^(.*?)(?::(.*))?$/
                {content, class: c ? 'warning'}

      # check live status of youtube or ustream
      entries.filter (?url) .map ->
        if it.type is 'video' and it.provider is 'youtube'
          request = gapi.client.youtube.videos.list({'id': it.id, 'part':'snippet'})
          response <~ request.execute()
          if 'live' == response.items?[0].snippet.liveBroadcastContent
            it.tags ++= {class: 'warning', content: 'LIVE'}
        else if videoToken = it.url.match(/ustream.tv\/embed\/([^?]+)/)
          videoId = videoToken[1]
          response <- $.get ("http://query.yahooapis.com/v1/public/yql?q=select%20*%20from%20html%20where%20url%3D'http%3A%2F%2Fapi.ustream.tv%2Fjson%2Fchannel%2F" + videoId + "%2FgetValueOf%2Fstatus'&format=json&diagnostics=true&callback=")
          if 'live' == JSON.parse(response.query?.results?.body?.p).results
            it.tags ++= {class: 'warning', content: 'LIVE'}
      docs.splice 0, docs.length, ...(entries.filter -> it?)
      last-parent = 0
      nested = for entry, i in docs
        if i > 0 and entry.indent
          docs[last-parent]
            ..children ?= []
              ..push entry
          null
        else
          last-parent = i
          entry
      nested .= filter -> it?
      nested .= map ->
        if it.children
          it.expand = it.opts?expand ? it.children.length < 5
        it
      tree.splice 0, tree.length, ...nested
      cb folder-title, docs
